<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AyoKajian ‚Äî API Connector</title>

<style>
:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --border:#e2e8f0;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#2563eb;
  --good:#16a34a;
  --bad:#ef4444;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  font-family:system-ui;
}

.wrap{
  max-width:720px;
  margin:auto;
  padding:24px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
}

h1{
  margin:0 0 6px;
  font-size:20px;
}

.sub{
  margin:0 0 20px;
  color:var(--muted);
  font-size:13px;
}

label{
  font-weight:700;
  font-size:13px;
  display:block;
  margin:14px 0 6px;
}

input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:14px;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:18px;
  flex-wrap:wrap;
}

button{
  border:none;
  padding:12px 16px;
  border-radius:10px;
  cursor:pointer;
  font-weight:800;
}

.primary{
  background:var(--accent);
  color:white;
}

.save{
  background:#111827;
  color:white;
}

.status{
  margin-top:16px;
  font-weight:700;
}

.good{ color:var(--good); }
.bad{ color:var(--bad); }

.small{
  margin-top:8px;
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="wrap">
  <div class="card">

    <h1>üîå AyoKajian API Connector</h1>
    <p class="sub">
      Hubungkan GitHub Pages ke Apps Script API kamu.
    </p>

    <label>Script URL (Web App /exec)</label>
    <input id="scriptUrl"
      placeholder="https://https://script.google.com/macros/s/AKfycby8BUFq4WF_9C5HsglCLOGykN7g_KpEBUMifnQj9Fgiv8fxP-xhWRxc0N6R0ZwJP8G9/exec"/>

    <label>API Key</label>
    <input id="apiKey"
      placeholder="Masukkan API key"/>

    <div class="actions">
      <button class="save" onclick="saveConfig()">
        üíæ Simpan Config
      </button>

      <button class="primary" onclick="testConnection()">
        üöÄ Test Connection
      </button>

      <button onclick="clearConfig()">
        üóë Reset
      </button>
    </div>

    <div id="status" class="status"></div>

    <div class="small">
      Config tersimpan di browser (localStorage).
    </div>

  </div>
</div>


<script>

// ============================
// AUTO LOAD CONFIG
// ============================

window.onload = () => {

  const url = localStorage.getItem("AYOKAJIAN_SCRIPT");
  const key = localStorage.getItem("AYOKAJIAN_KEY");

  if(url) document.getElementById("scriptUrl").value = url;
  if(key) document.getElementById("apiKey").value = key;

};


// ============================
// SAVE
// ============================

function saveConfig(){

  const url = document.getElementById("scriptUrl").value.trim();
  const key = document.getElementById("apiKey").value.trim();

  if(!url || !key){
    setStatus("Isi Script URL dan API Key dulu.", false);
    return;
  }

  localStorage.setItem("AYOKAJIAN_SCRIPT", url);
  localStorage.setItem("AYOKAJIAN_KEY", key);

  setStatus("Config tersimpan ‚úî", true);
}


// ============================
// RESET
// ============================

function clearConfig(){

  localStorage.removeItem("AYOKAJIAN_SCRIPT");
  localStorage.removeItem("AYOKAJIAN_KEY");

  document.getElementById("scriptUrl").value="";
  document.getElementById("apiKey").value="";

  setStatus("Config dihapus.", true);
}


// ============================
// STATUS UI
// ============================

function setStatus(msg, good){
  const el = document.getElementById("status");
  el.className = "status " + (good ? "good" : "bad");
  el.innerText = (good ? "‚úÖ " : "‚ùå ") + msg;
}


// ============================
// TEST CONNECTION
// ============================

async function testConnection(){

  const url = document.getElementById("scriptUrl").value.trim();
  const key = document.getElementById("apiKey").value.trim();

  if(!url || !key){
    setStatus("Script URL / API Key kosong.", false);
    return;
  }

  setStatus("Testing connection...", true);

  try{

    const res = await fetch(
      `${url}?key=${encodeURIComponent(key)}`
    );

    const text = await res.text();

    let json;

    try{
      json = JSON.parse(text);
    }catch{
      throw new Error("Response bukan JSON.");
    }

    if(json.ok){

      setStatus(
        "Connected! API siap dipakai üöÄ",
        true
      );

    }else{
      throw new Error(json.message || "API error");
    }

  }catch(err){

    setStatus(
      "Connection gagal: " + err.message,
      false
    );

  }

}

</script>
</body>
</html>
